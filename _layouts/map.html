---
layout: default
---

<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.0/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.0/mapbox.css' rel='stylesheet' />

<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

<style>
.leaflet-popup-content {background: #B44176; color: #fff; border-color: #fff; border-radius:12px; margin: 6px;}
.leaflet-popup-content-wrapper {border-radius: 12px; background: #B44176; color: #fff;}
.leaflet-popup-content a {color: #bada55;}
.leaflet-popup-content h2 {font-size:32px;}
.leaflet-popup-content a:hover {color: #d8fc62;}
.leaflet-popup-tip {border-top: 10px solid #B44176;}

.marker-cluster-small {
  background-color: rgba(180, 65, 118, 0.6);
}
.marker-cluster-small div {
  background-color: rgba(180, 65, 118, 0.6);
  color:#fff; 
  font-weight: bold;
}
</style>

<a href='' class='sprite maptime pin-right'>Maptime</a>

<script type="text/javascript">

L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JhZmEiLCJhIjoiU2U2QnIzUSJ9.4LnG05Ptvi1sUQ8t68rfgw';
var map = L.mapbox.map('map', null, {
	touchZoom: false, 
	scrollWheelZoom: false,
	worldCopyJump: true
});

// swap out layers and token periodically
var myLayer = L.tileLayer('http://api.tiles.mapbox.com/v4/grafa.a962eabc/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZ3JhZmEiLCJhIjoiU2U2QnIzUSJ9.4LnG05Ptvi1sUQ8t68rfgw')
    .addTo(map);

var featureLayer = L.mapbox.featureLayer();

map.setView([37.85750715625203,-84.55078125], 3);
featureLayer.loadURL('./chapters/map/maptimes.geojson');

featureLayer.on('ready', function(e) {
    // The clusterGroup gets each marker in the group added to it
    // once loaded, and then is added to the map
    
    var clusterGroup = new L.MarkerClusterGroup({
    	showCoverageOnHover: false, 
    	maxClusterRadius: 30
    });
    
    e.target.eachLayer(function(marker) {
        clusterGroup.addLayer(marker);
        var popupContent = '<h2>'+ marker.feature.properties.title +'</h2>' +
          'Twitter: ' + '<a href="http://twitter.com/' + marker.feature.properties.twitter + '" target="_blank">@' + marker.feature.properties.twitter +'</a>';
        // and bind it to the marker
        marker.bindPopup(popupContent);
        marker.setIcon(new L.Icon({
          iconUrl:'./img/maptime-marker.png',
          iconSize: [24,24],
          iconAnchor: [6,12],
          popupAnchor: [5,-10]
        }));
    });
    map.addLayer(clusterGroup);
});
</script>
{{content}}
